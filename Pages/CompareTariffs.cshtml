@page
@model EnergyTariffAdvisor.Pages.CompareTariffsModel
@using EnergyTariffAdvisor.Models
@{
    ViewData["Title"] = "Compare Tariffs";
}

<h2 class="mb-4">Compare Energy Tariffs</h2>

@if (TempData["ProfileInfo"] != null)
{
    <div class="alert alert-info">
        Using a sample profile. <a href="/ProfileEditor" class="alert-link">Edit your profile</a> for more accurate results.
    </div>
}

<!-- Card Section -->
<div class="row g-4 mb-4">
    <!-- Load Octopus Tariffs Card -->
    <div class="col-md-4 d-flex">
        <div class="card h-100 shadow-sm border-primary">
            <div class="card-header bg-primary text-white text-center">
                Load Octopus Tariffs
            </div>
            <div class="card-body d-flex flex-column">
                <p class="card-text">
                    Click to fetch real-time tariffs directly from Octopus Energy’s API.
                    <br /><br />
                    <small class="text-muted">
                        <strong>! Note:</strong> Start by loading Octopus data — then you can safely add Ofgem or manual tariffs.
                    </small>
                </p>

                <form method="post" asp-page-handler="LoadOctopus" class="mt-auto">
                    <button type="submit" class="btn btn-outline-primary w-100">Load Tariffs</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Ofgem Tariff Card -->
    <div class="col-md-4 d-flex">
        <div class="card h-100 shadow-sm border-danger">
            <div class="card-header bg-danger bg-opacity-25 text-dark text-center">
                Add Ofgem Tariff
            </div>
            <div class="card-body d-flex flex-column">
                <p class="card-text">Add the default tariff based on Ofgem’s price cap. Optional but useful for baseline comparison.</p>
                <form method="post" asp-page-handler="AddOFGEMTariff" class="mt-auto">
                    <div class="row flex-column">
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Tariff Name</label>
                            <input type="text" class="form-control" name="OFGEMTariffName" value="OFGEN-DEFAULT-2025" />
                        </div>
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Unit Rate (p/kWh)</label>
                            <input type="number" step="0.01" class="form-control" name="OFGEMUnitRate" value="27.35" />
                        </div>
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Standing Charge (p/day)</label>
                            <input type="number" step="0.01" class="form-control" name="OFGEMStandingCharge" value="58.69" />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-outline-danger w-100">Add Ofgem Tariff</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Manual Tariff Card -->
    <div class="col-md-4 d-flex">
        <div class="card h-100 shadow-sm border-info">
            <div class="card-header bg-info bg-opacity-25 text-dark text-center">
                Add Your Tariff
            </div>
            <div class="card-body d-flex flex-column">
                <p class="card-text">Manually enter your current tariff to include it in the comparison.</p>
                <form method="post" asp-page-handler="AddManualTariff" class="mt-auto">
                    <div class="row flex-column">
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Tariff Name</label>
                            <input type="text" class="form-control" name="ManualTariffName" value="My Current Tariff" />
                        </div>
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Unit Rate (p/kWh)</label>
                            <input type="number" step="0.01" class="form-control" name="ManualUnitRate" />
                        </div>
                        <div class="col mb-2 d-flex align-items-center">
                            <label class="form-label me-2 text-end" style="min-width: 120px; width: 120px;">Standing Charge (p/day)</label>
                            <input type="number" step="0.01" class="form-control" name="ManualStandingCharge" />
                        </div>
                    </div>
                    <button type="submit" class="btn btn-outline-info w-100">Add Manual Tariff</button>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Tariff Table Section -->
@if (Model.AvailableTariffs.Any())
{
    <div class="alert alert-warning">
        Please select tariffs only after you have finished adding all desired tariffs.
    </div>

    <button type="button" id="selectAllBtn" class="btn btn-sm btn-secondary me-2" style="min-width: 150px;">
        <i class="bi bi-flag-fill me-1"></i> Select All
    </button>
    <button type="button" id="deselectAllBtn" class="btn btn-sm btn-secondary" style="min-width: 150px;">
        <i class="bi bi-flag me-1"></i> Deselect All
    </button>
    <script>
        document.getElementById('selectAllBtn').addEventListener('click', function () {
            document.querySelectorAll('input[name="SelectedTariffs"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        });
        document.getElementById('deselectAllBtn').addEventListener('click', function () {
            document.querySelectorAll('input[name="SelectedTariffs"]').forEach(checkbox => {
                checkbox.checked = false;
            });
                });
    </script>

    <form method="post" asp-page-handler="Calculate">
        <table class="table table-striped table-bordered align-middle">
            <thead>
                <tr>
                    <th>Select</th>
                    <th>Details</th>
                    <th>Tariff Type</th>
                    <th>Tariff Code</th>
                    <th>Unit Rate (p/kWh)</th>
                    <th>Standing Charge (p/day)</th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < Model.AvailableTariffs.Count; i++)
                {
                    var tariff = Model.AvailableTariffs[i];
                    <tr class="@(tariff.TariffCode.StartsWith("OFGEM") ? "table-danger" :
                                                                                     tariff.TariffCode == "MANUAL" ? "table-info" : "")">
                <td><input type="checkbox" value="@i" name="SelectedTariffs" /></td>
                <td>
                    <a asp-page-handler="ViewDetails"
                       asp-route-index="@i"
                       class="btn btn-sm btn-info"
                       target="_blank">
                        Details
                    </a>
                </td>
                <td>@tariff.TariffType</td>
                <td>@tariff.TariffCode</td>
                <td>@tariff.GetUnitRateDisplay()</td>
                <td>@tariff.StandingChargeDaily.ToString("0.##")</td>
            </tr>
                        }
            </tbody>
        </table>
        <button type="submit" class="btn btn-success">Calculate</button>
    </form>
}
else
{
    <p>No tariffs added.</p>
}



